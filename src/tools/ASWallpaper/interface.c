/*
 * DO NOT EDIT THIS FILE - it is generated by Glade.
 */

#include "../../../../configure.h"
#include "../../../../libAfterImage/afterimage.h"
#include "../../../../libAfterStep/asapp.h"
#include "../../../../libAfterStep/screen.h"


#include <sys/types.h>
#include <sys/stat.h>
#include <unistd.h>
#include <string.h>
#include <stdio.h>

#include <gdk/gdkkeysyms.h>
#include <gtk/gtk.h>

#include "callbacks.h"
#include "interface.h"
#include "support.h"

#define GLADE_HOOKUP_OBJECT(component,widget,name) \
  g_object_set_data_full (G_OBJECT (component), name, \
    gtk_widget_ref (widget), (GDestroyNotify) gtk_widget_unref)

#define GLADE_HOOKUP_OBJECT_NO_REF(component,widget,name) \
  g_object_set_data (G_OBJECT (component), name, widget)


ASImageListEntry *PrivateBackgroundsList = NULL ;
int PrivateBackgroundsCount = 0;


void
fill_private_backgrounds_list(GtkListStore *model)
{
    GtkTreeIter iter;
	
	ASImageListEntry *curr ;
	char *private_back_dir = PutHome("~/.afterstep/backgrounds");

	if( PrivateBackgroundsList )
		destroy_asimage_list( &PrivateBackgroundsList );
	PrivateBackgroundsList = get_asimage_list( Scr.asv, private_back_dir,
	              						       LOAD_PREVIEW, Scr.image_manager->gamma, 0, 0,
											   0, &PrivateBackgroundsCount, ignore_dots );

	curr = PrivateBackgroundsList ;
	while( curr )
	{
		if( curr->preview )
		{
	        gtk_list_store_append (GTK_LIST_STORE (model), &iter);
    	    gtk_list_store_set (GTK_LIST_STORE (model), &iter, 0, curr->name, 1, curr, -1);
		}
		curr = curr->next ;
	}
}

void 
on_main_list_cursor_change(GtkTreeView *treeview, gpointer user_data)
{
	GtkWidget *list_preview = user_data ;
	GtkTreeIter iter ;
	GtkTreePath *path ;
	GtkTreeViewColumn *focus_column ;
	GtkTreeModel *model = gtk_tree_view_get_model(treeview);
	GValue val ;
	gpointer p = NULL ;
	ASImageListEntry *curr ;

	 
	gtk_tree_view_get_cursor( treeview, &path, &focus_column );
	if( gtk_tree_model_get_iter(model, &iter, path ) )
	{	
		gtk_tree_model_get_value( model, &iter, 1, &val );
	 	p = g_value_peek_pointer( &val );
	}

	if( (curr = p) != NULL && curr->preview ) 
	{
		/* TODO : display image */
		
	}	 

}



GtkWidget*
create_main_window (void)
{
  GtkWidget *main_window;
  GtkWidget *main_vbox;
  GtkWidget *list_hbox;
  GtkWidget *list_window, *list, *list_preview ;

    GtkListStore *model;
    GtkCellRenderer *cell;
    GtkTreeViewColumn *column;

  GtkWidget *Select;
  GtkWidget *button_generate_as_bg;
  GtkWidget *Quit;

  GtkWidget *buttons_hbox;

  main_window = gtk_window_new (GTK_WINDOW_TOPLEVEL);
  gtk_window_set_title (GTK_WINDOW (main_window), _("AfterStep Wallpaper Manager"));

  main_vbox = gtk_vbox_new (FALSE, 0);
  gtk_widget_show (main_vbox);
  gtk_container_add (GTK_CONTAINER (main_window), main_vbox);

  list_hbox = gtk_hbox_new (FALSE, 0);
  gtk_widget_show (list_hbox);
  gtk_box_pack_start (GTK_BOX (main_vbox), list_hbox, FALSE, FALSE, 5);

  	list_window = gtk_scrolled_window_new (NULL, NULL);
    gtk_scrolled_window_set_policy (GTK_SCROLLED_WINDOW (list_window),
				    				GTK_POLICY_AUTOMATIC, GTK_POLICY_AUTOMATIC);
	gtk_box_pack_start (GTK_BOX (list_hbox), list_window, FALSE, FALSE, 5);
    gtk_widget_set_size_request (list_window, 200, 300);
	gtk_widget_show (list_window);
	list = gtk_tree_view_new();
    model = gtk_list_store_new (2, G_TYPE_STRING, G_TYPE_POINTER);
    gtk_scrolled_window_add_with_viewport (GTK_SCROLLED_WINDOW (list_window), list);
    gtk_tree_view_set_model (GTK_TREE_VIEW (list), GTK_TREE_MODEL (model));
    gtk_widget_show (list);
    cell = gtk_cell_renderer_text_new ();
    column = gtk_tree_view_column_new_with_attributes ("Images in your private backgrounds folder:", cell, "text", 0, NULL);
    gtk_tree_view_append_column (GTK_TREE_VIEW (list), GTK_TREE_VIEW_COLUMN (column));

	list_preview = gtk_image_new();
  	gtk_widget_show (list_preview);
  	gtk_widget_set_size_request (list_preview, 320, 240);
  	gtk_box_pack_end (GTK_BOX (list_hbox), list_preview, FALSE, FALSE, 5);

  	g_signal_connect ((gpointer) list, "cursor-changed",
                       G_CALLBACK (on_main_list_cursor_change),
                       list_preview);

  fill_private_backgrounds_list(model);


  buttons_hbox = gtk_hbox_new (FALSE, 0);
  gtk_widget_show (buttons_hbox);
  gtk_box_pack_end (GTK_BOX (main_vbox), buttons_hbox, FALSE, FALSE, 5);
	
  Select = gtk_button_new_from_stock ("gtk-open");
  gtk_widget_show (Select);
  gtk_box_pack_start (GTK_BOX (buttons_hbox), Select, FALSE, FALSE, 20);

  button_generate_as_bg = gtk_button_new_with_mnemonic (_("Generate AS wallpaper"));
  gtk_widget_show (button_generate_as_bg);
  gtk_box_pack_start (GTK_BOX (buttons_hbox), button_generate_as_bg, FALSE, FALSE, 20);
  gtk_widget_set_size_request (button_generate_as_bg, 150, -1);

  Quit = gtk_button_new_from_stock ("gtk-quit");
  gtk_widget_show (Quit);
  gtk_box_pack_start (GTK_BOX (buttons_hbox), Quit, FALSE, FALSE, 20);
  gtk_widget_set_size_request (Quit, 150, -1);



  g_signal_connect ((gpointer) Select, "clicked",
                    G_CALLBACK (on_open_clicked),
                    NULL);
  g_signal_connect ((gpointer) button_generate_as_bg, "clicked",
                    G_CALLBACK (on_generate_as_bg_clicked),
                    NULL);
  g_signal_connect ((gpointer) Quit, "clicked",
                    G_CALLBACK (on_quit_clicked),
                    NULL);

  /* Store pointers to all widgets, for use by lookup_widget(). */
  GLADE_HOOKUP_OBJECT_NO_REF (main_window, main_window, "main_window");
//  GLADE_HOOKUP_OBJECT (window1, vbox1, "vbox1");
//  GLADE_HOOKUP_OBJECT (window1, Select, "Select");
//  GLADE_HOOKUP_OBJECT (window1, hbox1, "hbox1");
//  GLADE_HOOKUP_OBJECT (window1, button_generate_as_bg, "button_generate_as_bg");
//  GLADE_HOOKUP_OBJECT (window1, Quit, "Quit");

  return main_window;
}

GtkWidget*
create_filechooserdialog2 (void)
{
  GtkWidget *filechooserdialog2;
  GtkWidget *dialog_vbox2;
  GtkWidget *dialog_action_area2;
  GtkWidget *button_file_cancel;
  GtkWidget *button_file_open;

  filechooserdialog2 = gtk_file_chooser_dialog_new ("", NULL, GTK_FILE_CHOOSER_ACTION_OPEN, NULL);
  gtk_window_set_type_hint (GTK_WINDOW (filechooserdialog2), GDK_WINDOW_TYPE_HINT_DIALOG);

  dialog_vbox2 = GTK_DIALOG (filechooserdialog2)->vbox;
  gtk_widget_show (dialog_vbox2);

  dialog_action_area2 = GTK_DIALOG (filechooserdialog2)->action_area;
  gtk_widget_show (dialog_action_area2);
  gtk_button_box_set_layout (GTK_BUTTON_BOX (dialog_action_area2), GTK_BUTTONBOX_END);

  button_file_cancel = gtk_button_new_from_stock ("gtk-cancel");
  gtk_widget_show (button_file_cancel);
  gtk_dialog_add_action_widget (GTK_DIALOG (filechooserdialog2), button_file_cancel, GTK_RESPONSE_CANCEL);
  GTK_WIDGET_SET_FLAGS (button_file_cancel, GTK_CAN_DEFAULT);

  button_file_open = gtk_button_new_from_stock ("gtk-open");
  gtk_widget_show (button_file_open);
  gtk_dialog_add_action_widget (GTK_DIALOG (filechooserdialog2), button_file_open, GTK_RESPONSE_OK);
  GTK_WIDGET_SET_FLAGS (button_file_open, GTK_CAN_DEFAULT);

  g_signal_connect_swapped (G_OBJECT (button_file_cancel),
	                        "clicked", G_CALLBACK (gtk_widget_destroy),
		 			        G_OBJECT (filechooserdialog2));

  g_signal_connect ((gpointer) button_file_open, "clicked",
                    G_CALLBACK (on_file_open_clicked),
                    NULL);

  /* Store pointers to all widgets, for use by lookup_widget(). */
  GLADE_HOOKUP_OBJECT_NO_REF (filechooserdialog2, filechooserdialog2, "filechooserdialog2");
  GLADE_HOOKUP_OBJECT_NO_REF (filechooserdialog2, dialog_vbox2, "dialog_vbox2");
  GLADE_HOOKUP_OBJECT_NO_REF (filechooserdialog2, dialog_action_area2, "dialog_action_area2");
  GLADE_HOOKUP_OBJECT (filechooserdialog2, button_file_cancel, "button_file_cancel");
  GLADE_HOOKUP_OBJECT (filechooserdialog2, button_file_open, "button_file_open");

  gtk_widget_grab_default (button_file_open);
  return filechooserdialog2;
}

